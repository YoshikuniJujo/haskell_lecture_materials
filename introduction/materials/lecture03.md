第3回 vimを学ぶ
===============

はじめに
--------

「Haskell講座」では聞いているだけでなく手を動かすことで
学習効果を高めるようにしている。
そのためにはエディタが使える必要がある。
指になじむエディタというものはプログラマの強力な武器となる。

今回はvimについて学ぶ。
しかし「エディタ戦争勃発」をふせぐためにnanoとEmacsも用意しておいた。
nanoやEmacsが指になじむという人はそれらを使っていただきたい。

演者がvim使いなので、ここでは、vimについて学ぶことにしよう。

vimの特徴
---------

カーソルの移動等の編集作業に普通のキーを使うということが大きな特徴である。
マウスは使わないので、いちいちキーボードから手を離す必要がない。
たとえば、カーソルの左上下右への移動にはそれぞれ'h', 'j', 'k', 'l'キーを使用する。

ここで、普通にアルファベットを入力したいときはどうすれば良いのか
という疑問が生じる。
答えはそれぞれの「モード」を用意するということだ。
ノーマルモードではカーソル移動等のコマンド入力を行い、
インサートモードでは直接文字を入力するようにすれば良い。

つまりvimは「モード付きのエディタ」であり、
vimを使用するときには常にモードを意識するということになる。

練習を始める前に
----------------

今回の講義では基本的な機能と、それ以外の便利な機能の一部を紹介する。
もちろん、今すべて覚える必要はない。
一度触れておくことで、
何かの際に「確か、こんな機能があったはず」と思い出せるだろう。

最後にもう一度触れるが、最低限必要なコマンドは以下の通りである。

* 'h', 'j', 'k', 'l'によるカーソル移動
* 'i', 'a'によるインサートモードへの遷移
* Escキーによるノーマルモードへの遷移
* 'x'による一文字削除
* ':wq'による保存終了

カーソル移動
------------

HHKBの練習のときに当ったファイルを開こう。

    vim practice.txt

カーソルは一番左下にある。
カーソルを左右に動かしてみよう。

* 左: h
* 右: l

何度か'l'を押してカーソルを右端まで持っていく。
次に、'h'を押してカーソルを左端まで持っていってみよう。

次は上下移動を試してみよう。

* 下: j
* 上: k

何度か'j'を押してカーソルを一番上まで持っていこう。
次に、'k'を押してカーソルを一番下まで持っていってみよう。

インサートモード
----------------

今学んだ'h', 'j', 'k', 'l'を使ってカーソルを好きな場所に移動させ、'i'を押す。
これで、インサートモードになった。

以下のように入力してみよう。

    Hello, world!

入力が終わったらインサートモードから抜ける。
Escキーを押せば良い。
EscキーはHHKBでは左手小指をめいっぱい左上にのばしたところにある。
これで'h', 'j', 'k', 'l'でカーソル移動ができるモードになる。
vimではこの状態が基本なので、このモードをノーマルモードと呼ぶ。

もとに戻す
----------

まちがった編集をしてしまってもとに戻したいときには'u'を押せば良い。

    undo: u

"Hello, world!"の'w'にカーソルを合わせてみよう。
そこで'i'を押し何かを入力する。
たとえば"miss"と入力してみよう。
Escキーでノーマルモードにもどってから'u'を押してみる。
もとに戻ったはずだ。

ちょっとしたまちがいならば、すぐにもとに戻すことができる。

インサートモード再び
--------------------

インサートモードへの移行にはいくつかの方法がある。
さっきと同じように'w'にカーソルを合わせてみよう。
ここで'i'を押し適当な文字を入力する。
たとえば"ABC"を入力する。
'w'の「前に」文字列が挿入される。
Escキーでノーマルモードに戻り、'u'でもとに戻す。

今度は'a'を押してから適当な文字を入力しよう。
たとえば"DEF"を入力する。
'w'の「後ろに」文字列が入力される。

* 'i': カーソルの前に文字列を挿入する
* 'a': カーソルの後ろに文字列を挿入する

行を変えて挿入
--------------

新たな行を加えたいということはよくある。
カーソルを適当な行に移動させてから'o'を押してみよう。
カーソルがあった行の下に新たな行ができる。
以下を入力してからEscキーを押そう。

    Hello, wworld!
    (wが重なっているのは次の練習のためなのでそのまま入力しよう)

'o'コマンドは「この下に新しい行を足そう」というときに便利だ。

一文字削除
----------

さっきの入力ではwが2つ入力されていた。
'h'キーを使ってカーソルを'w'に合わせよう。

    そこで'x'キーですよ
    ("wworld"となっていたのが"world"に修正される)

消したい文字があったらhjklでカーソルを合わせ'x'コマンドを入力する。

一行削除・貼り付け
------------------

'j', 'k'コマンドで好きな行に移動しよう。
そこで'd'を2回連続で入力すると、その1行が削除される。

'j', 'k'コマンドで適当な行に移動する。
そこで'p'を押すと、移動した行の「下に」削除した行が挿入される。

ここで一度'u'コマンドでもとに戻す。
今度は'P'を入力してみよう。
カーソルのある行の「上に」行が挿入されるだろう。

一行コピー
----------

'j', 'k'コマンドで好きな行に移動する。
'y'を連続で2回入力する。
この時点では何も起きていないように見える。

再度適当な行に移動して、'p'を押す。
さっきの行がコピーされているのがわかるだろう。

複数行削除・コピー
------------------

適当な行に移動し、大文字の'V'を押してみよう。
'j'や'k'でカーソルを移動すると、選択範囲が白黒反転する。
好きな範囲を選択したら'd'を押す。
選択範囲が削除されるはずだ。
適当な行に移動し'p'を入力するとその行の下に複数の削除された行が挿入される。

次に'd'の代わりに'y'にして同じことをしてみよう。
今度は選択範囲がコピーされるだろう。

行頭・行末への移動
------------------

行頭や行末に移動したいことはしばしばある。
'h'や'l'で1文字ずつ移動しても良いが、もっと効率的なやりかたがある。
適当な行に移動して'0'を入力してみよう。
次に'$'を入力してみよう。
'0'と'$'を交互に入力すると、カーソルが行頭・行末を行き来するのが分かるだろう。

一文字をねらって
----------------

### 移動する文字を決める

今度は行内の好きな文字をねらった移動を見てみよう。
'o'コマンドを入力してから、以下の文字列を入力する。

    One little, two little, three little Indians

'0'コマンドで行の先頭に移動しておく。
ここでカーソルを文字'o'に移動したいとする。
'fo'と打ってみよう。
カーソルが'two'の'o'に移動するはずだ。

### 次の文字へ

次に'Indians'のふたつめの'n'をねらいたいとする。
'fn'と打つとまずはひとつめの'n'に移動する。
もう一度'fn'としても良いが、もっと簡単な方法がある。
';'を入力してみよう。
カーソルは「次の」'n'に移動する。

### もどる

もう一度'0'を入力して行頭にカーソルを戻しておこう。
今度は'two little'の3番目のtに移動させたいとしよう。
'ft'を入力し';'を何度か押してみよう。

ここでは、わざとねらった't'を通り越すまで';'を入力する。
そして、次に','を入力してみよう。
ひとつ前の't'にもどっただろう。

';'と','を適当に入力してカーソルの移動の様子を観察しよう。

ファイルの先頭・末尾への移動
----------------------------

'g'を2回入力してみよう。
次に大文字'G'を入力してみよう。
これをくりかえす。
カーソルがファイルの先頭と末尾を行き来する。

スクロール
----------

### 準備

スクロールの練習をするために長いファイルを作る。
好きな行に移動し、大文字'V'を入力しjまたはkを何度か押して
複数行を選択する。
'y'コマンドでコピーし、'50p'と入力してみよう。
選択範囲が50倍になってコピーされる。

### スクロールしてみる

まずはCtrl+'e'を何度か押してみよう。
次にCtrl+'y'を何度か押す。
画面が上下に移動するのがわかるだろう。

Ctrl+'d'を何度か押してみよう。
次にCtrl+'u'を何度か押す。
画面半分を単位として画面が上下に移動する。

画面内移動
----------

'H', 'M', 'L'と順に打ってみよう。
カーソルが画面の上中下と移動する。

指定行への移動
--------------

行番号で指定した行に移動することができる。
'50g'と打ってみよう。
カーソルがファイルの50行目に移動する。

ここで、次の練習のために文字列を入力しておく。
'h'や'l'コマンドでカーソルを適当に移動して'i'コマンドで以下を入力する。

    here you are

'yy'でこの行をクリップボードに保存する。
[数]gで好きな行に移動してpで貼り付ける。
この移動と貼り付けを何度かくりかえす。
ファイルのいろいろな場所に"here you are"が挿入される。

検索移動
--------

とりあえず、'gg'でファイルの先頭に移動しておこう。
ここで'/you'と入力し、エンターキーを押す。
カーソルが'you'の先頭の'y'に移動する。

次に'n'を入力する。
'n'を入力するたびに「次の」youにカーソルが移動する。

今度は大文字の'N'を入力してみよう。
大文字'N'を入力すると「前の」youにカーソルが移動する。

保存終了
--------

':wq'を入力しエンターキーを押すと保存終了できる。

まとめ
------

よく使う機能についてひととおり練習してみた。
これ以外にもvimには多くのコマンドが存在する。
一度に全部覚える必要はない。
ひとつコマンドを覚えるたびにひとつ編集効率が上がる。

はじめは以下のコマンドだけ覚えておけば良いだろう。

* 'h', 'j', 'k', 'l'によるカーソル移動
* 'i', 'a'によるインサートモードへの遷移
* Escキーによるノーマルモードへの遷移
* 'x'による一文字削除
* ':wq'による保存終了
